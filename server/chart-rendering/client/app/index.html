<!--
  ~  Copyright 2024, TeamDev. All rights reserved.
  ~
  ~  Redistribution and use in source and/or binary forms, with or without
  ~  modification, must retain the above copyright notice and the following
  ~  disclaimer.
  ~
  ~  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
  ~  "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
  ~  LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
  ~  A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
  ~  OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
  ~  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
  ~  LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
  ~  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
  ~  THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  ~  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
  ~  OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  -->

<!DOCTYPE html>
<html lang="en">
<head>
    <title>Exporting rich charts as images</title>
</head>
<body>
<div style="width: 800px;">
    <canvas id="fossil-fuels-consumption"></canvas>
</div>
<button id="fossil-fuels-consumption-export" onclick="exportFossilFuelsConsumptionChart()">
    Export to PNG
</button>
<script type="text/javascript" src="./chart-drawing.js"></script>
<script type="text/javascript">
    const SERVER_URL = 'http://localhost:8080';

    async function exportFossilFuelsConsumptionChart() {
        const data = await fetch(`${SERVER_URL}/export/fossil-fuels-consumption/png`)
            .then(r => r.blob());
        const filename = 'fossil-fuels.png';
        if(confirm(`Saved as './exported/${filename}' on the server. Download on this PC?`)) {
            const url = window.URL.createObjectURL(data);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
        }
    }

    function httpGet(url) {
        const xmlHttp = new XMLHttpRequest();
        xmlHttp.open('GET', url, false);
        xmlHttp.send(null);
        return xmlHttp.responseText;
    }

    const data = httpGet(`${SERVER_URL}/dataset/fossil-fuels-consumption`);
    window.drawFossilFuelsConsumptionChart('fossil-fuels-consumption', data);
</script>
</body>
</html>
